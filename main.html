<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RC Car Control</title>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyB79wb5DsH69pOQw35Nk2hg96_Xz0mEfWY",
  authDomain: "rccar-2b355.firebaseapp.com",
  databaseURL: "https://rccar-2b355-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "rccar-2b355",
  storageBucket: "rccar-2b355.appspot.com",
  messagingSenderId: "505701251853",
  appId: "1:505701251853:web:de2fbbd641e33dfd348e44"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let currentCommand = "";

function sendCommand(cmd) {
  if(currentCommand !== cmd){
    currentCommand = cmd;
    set(ref(db, '/command'), cmd).catch(err => console.error(err));
  }
}

function releaseCommand() {
  currentCommand = "";
  set(ref(db, '/command'), "").catch(err => console.error(err));
}

function sendSpeed() {
  const speed = parseInt(document.getElementById("speedSlider").value);
  document.getElementById("speedValue").innerText = speed;
  set(ref(db, '/speed'), speed).catch(err => console.error(err));
}

window.addEventListener('DOMContentLoaded', () => {
  const buttons = ["forward","backward","left","right"];
  buttons.forEach(id => {
    const btn = document.getElementById(id);
    btn.addEventListener("mousedown", () => sendCommand(id));
    btn.addEventListener("mouseup", releaseCommand);
    btn.addEventListener("mouseleave", releaseCommand);
    btn.addEventListener("touchstart", (e) => { e.preventDefault(); sendCommand(id); });
    btn.addEventListener("touchend", releaseCommand);
  });

  document.getElementById("speedSlider").addEventListener("input", sendSpeed);
  sendSpeed(); // initialize displayed value
});
</script>
<style>
body { font-family: sans-serif; text-align:center; padding:20px; }
button { width:100px; height:60px; margin:10px; font-size:18px; cursor:pointer; }
#speedSlider { width:200px; margin-top:20px; }
</style>
</head>
<body>

<h2>RC Car Control</h2>

<div>
  <button id="forward">Forward</button>
</div>
<div>
  <button id="left">Left</button>
  <button id="backward">Backward</button>
  <button id="right">Right</button>
</div>

<div style="margin-top:20px;">
  <label for="speedSlider">Speed: <span id="speedValue">150</span></label><br>
  <input type="range" id="speedSlider" min="50" max="255" value="150">
</div>

</body>
</html>
