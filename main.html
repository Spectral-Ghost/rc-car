<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RC Car Control</title>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
  import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB79wb5DsH69pOQw35Nk2hg96_Xz0mEfWY",
    authDomain: "rccar-2b355.firebaseapp.com",
    databaseURL: "https://rccar-2b355-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "rccar-2b355",
    storageBucket: "rccar-2b355.appspot.com",
    messagingSenderId: "505701251853",
    appId: "1:505701251853:web:de2fbbd641e33dfd348e44"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let currentCommand = "";

  function sendCommand(cmd) {
    if(currentCommand !== cmd){
      currentCommand = cmd;
      set(ref(db, '/command'), cmd);
    }
  }

  function releaseCommand() {
    currentCommand = "";
    set(ref(db, '/command'), "");
  }

  function sendSpeed() {
    const speed = parseInt(document.getElementById("speedSlider").value);
    set(ref(db, '/speed'), speed);
  }

  // Event listeners
  window.addEventListener('DOMContentLoaded', () => {
    document.getElementById("forward").addEventListener("mousedown", () => sendCommand("forward"));
    document.getElementById("forward").addEventListener("mouseup", releaseCommand);
    document.getElementById("backward").addEventListener("mousedown", () => sendCommand("backward"));
    document.getElementById("backward").addEventListener("mouseup", releaseCommand);
    document.getElementById("left").addEventListener("mousedown", () => sendCommand("left"));
    document.getElementById("left").addEventListener("mouseup", releaseCommand);
    document.getElementById("right").addEventListener("mousedown", () => sendCommand("right"));
    document.getElementById("right").addEventListener("mouseup", releaseCommand);

    document.getElementById("speedSlider").addEventListener("input", sendSpeed);
  });
</script>
<style>
  button { width:100px; height:100px; margin:10px; font-size:16px; }
  #controls { display:flex; flex-wrap:wrap; justify-content:center; }
</style>
</head>
<body>
<h1>RC Car Control</h1>
<div id="controls">
  <button id="forward">Forward</button>
  <button id="backward">Backward</button>
  <button id="left">Left</button>
  <button id="right">Right</button>
</div>
<br>
<label for="speedSlider">Speed:</label>
<input type="range" id="speedSlider" min="50" max="255" value="150">
</body>
</html>
