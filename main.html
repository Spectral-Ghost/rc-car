<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>RC Robot Control</title>
<style>
body { font-family: Arial; text-align: center; margin-top: 50px; }
button { width: 80px; height: 60px; font-size: 24px; margin: 5px; }
input[type=range] { width: 300px; margin-top: 20px; }
</style>
</head>
<body>

<h1>RC Robot Control</h1>

<div style="display:inline-block; text-align:center; margin-top:30px;">
  <div><button id="btnForward">↑</button></div>
  <div>
    <button id="btnRight">←</button> <!-- swapped -->
    <button id="btnStop">■</button>
    <button id="btnLeft">→</button> <!-- swapped -->
  </div>
  <div><button id="btnBackward">↓</button></div>
</div>

<div style="margin-top:20px;">
  <label for="speedRange">Speed:</label><br>
  <input type="range" id="speedRange" min="50" max="255" value="150">
  <span id="speedValue">150</span>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyB79wb5DsH69pOQw35Nk2hg96_Xz0mEfWY",
  authDomain: "rccar-2b355.firebaseapp.com",
  databaseURL: "https://rccar-2b355-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "rccar-2b355",
  storageBucket: "rccar-2b355.firebasestorage.app",
  messagingSenderId: "505701251853",
  appId: "1:505701251853:web:de2fbbd641e33dfd348e44"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let speed = 150;

function updateSpeed(val){
  speed = parseInt(val); // convert string to number
  document.getElementById('speedValue').innerText = speed;
  set(ref(db, '/speed'), speed);
}

function sendCommand(cmd){ set(ref(db, '/command'), cmd); }
function stopCommand(){ set(ref(db, '/command'), ""); }

function holdButton(buttonId, command){
  const btn = document.getElementById(buttonId);
  btn.addEventListener('mousedown', ()=>sendCommand(command));
  btn.addEventListener('mouseup', stopCommand);
  btn.addEventListener('mouseleave', stopCommand);
  btn.addEventListener('touchstart', ()=>sendCommand(command));
  btn.addEventListener('touchend', stopCommand);
}

// Buttons with corrected left/right commands
holdButton('btnForward', 'forward');
holdButton('btnBackward', 'backward');
holdButton('btnLeft', 'left');   // now correctly sends "left"
holdButton('btnRight', 'right'); // now correctly sends "right"
holdButton('btnStop', 'stop');

document.getElementById('speedRange').addEventListener('input', (e)=>updateSpeed(e.target.value));

// initialize speed display
updateSpeed(document.getElementById('speedRange').value);
</script>

</body>
</html>
